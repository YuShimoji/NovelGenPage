# 現在の課題と開発計画

## 現在の主な課題

### 0. シナリオエディタの重複表示（解決済み 2025-08-16）
- **内容**: `scenario-editor.html` でエディタが二重に表示される
- **原因**: Quill 初期化の二重実行と、既存ツールバーDOMと新規生成ツールバーの混在
- **対応**: `static/js/editor.js` をリファクタリングし、単一初期化・既存ツールバーの再利用・既存インスタンスのクリーンアップを実装
- **結果**: 再発防止のためのガードを追加（`initializeEditor()` の単一呼び出し、`initQuill()` の分離、既存DOM検出）

### 1. プレビュー機能
- **問題**: プレビューエリアに何も表示されない
- **原因**: マークダウンパーサーまたはレンダリング処理に問題がある可能性
- **優先度**: 高

### 1a. Markdown リンクレンダラの互換性エラー（解決済み 2025-08-18）
- **内容**: `TypeError: href.match is not a function` が `static/js/markdown-converter.js` のカスタム `renderer.link` で発生
- **原因**: marked の新APIで `link(token)` 形式のオブジェクトが渡されるケースに未対応だった
- **対応**: 旧API（`link(href, title, text)`）/新API（`link(token)`）両対応のガードを追加。`scene:` リンクは `.scene-link` へ変換し、それ以外は既定レンダラへ委譲
- **結果**: シーン/選択肢スニペット挿入後のプレビュー更新でエラーが発生しないことを確認。テンプレートの読み込みを `markdown-converter.js?v=1.0.4` に更新

### 2. エディタの使い勝手
- **問題**: マークダウンエディタがライターにとって使いにくい
- **要望**: 記述スペースとボタン・プルダウンのみで執筆可能なUI
- **優先度**: 中

### 3. 新着ストーリー
- **問題**: 新着ストーリーが表示されない
- **原因**: データ取得または表示処理に問題がある可能性
- **優先度**: 高

### 4. AI生成機能
- **問題**: 部分的にAIを活用する方法が不明確
- **必要な対応**: 
  - 使用するAIモデルの選定
  - API設計
  - プロンプトテンプレートの作成
- **優先度**: 中

### 5. 構文チェック
- **問題**: 構文チェックボタンの機能が不明
- **必要な対応**:
  - 構文チェックの仕様策定
  - 実装
- **優先度**: 低

### 6. 保存機能
- **問題**: 保存が機能せず、保存先も不明
- **必要な対応**:
  - 保存先の決定（ローカルストレージ/データベース）
  - 保存処理の実装
- **優先度**: 高

### 7. ストーリー一覧
- **問題**: ストーリー一覧ページが空
- **必要な対応**:
  - データ取得処理の実装
  - 一覧表示UIの実装
- **優先度**: 中

## 開発計画

### 短期目標（1-2週間）
1. プレビュー機能の修正
2. 保存機能の実装
3. 新着ストーリーの表示修正

### 中期目標（1ヶ月）
1. エディタUIの改善
2. ストーリー一覧機能の実装
3. 基本的なAI生成機能のプロトタイプ作成

### 長期目標（2-3ヶ月）
1. AI生成機能の本格実装
2. 構文チェック機能の実装
3. パフォーマンス最適化
4. テストカバレッジの向上

## 次のステップ

1. プレビュー機能のデバッグ
   - マークダウンパーサーの動作確認
   - レンダリング処理の確認

2. 保存機能の実装
   - 保存先の決定
   - APIエンドポイントの作成
   - フロントエンドとの連携

3. エディタUIの改善
   - ライター向けのUIコンポーネントの選定
   - マークダウン記法のショートカット実装

4. データ管理
   - ストーリーデータのスキーマ設計
   - データベース接続の設定
