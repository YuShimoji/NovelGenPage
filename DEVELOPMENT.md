# 開発ガイド

## 環境構築

### 必要なツール
- Python 3.8+
- Node.js 16+
- npm または yarn
- Git

### セットアップ手順

1. リポジトリのクローン
   ```bash
   git clone https://github.com/your-username/NovelGenPage.git
   cd NovelGenPage
   ```

2. バックエンドのセットアップ
   ```bash
   # 仮想環境の作成と有効化
   python -m venv venv
   source venv/bin/activate  # Windows: .\venv\Scripts\activate
   
   # 依存関係のインストール
   pip install -r requirements.txt
   
   # 環境変数の設定 (.env ファイルを作成)
   cp .env.example .env
   # .env を編集して必要な設定を追加
   ```

3. フロントエンドのセットアップ
   ```bash
   cd static
   npm install
   cd ..
   ```

## 注意点とトラブルシューティング

### JavaScriptの読み込み問題
- `type="module"` を使用する場合、サーバーが正しいMIMEタイプでファイルを配信する必要があります
- エラーが発生する場合は、`<script src="..."></script>` の形式で読み込むことを検討してください
- ブラウザの開発者ツールのコンソールでエラーが表示されていないか確認してください

### デバッグのヒント
- `debugLog` 関数を使用して、重要な処理の前後にログを出力する
- イベントリスナーが正しく設定されているか確認するために、初期化時にコンソールログを出力する
- 動的に追加される要素のイベントは、イベントデリゲーションを使用することを検討する

## 開発サーバーの起動

### バックエンドサーバー
```bash
# 仮想環境が有効になっていることを確認
uvicorn main:app --reload
```

### フロントエンド開発サーバー
```bash
cd static
npm run dev
```

## テストの実行

### バックエンドテスト
```bash
pytest
```

### フロントエンドテスト
```bash
cd static
npm test
```

## コーディング規約

### コードスタイル
- Python: PEP 8 に準拠
- JavaScript: ESLint + Prettier を使用
- コミット前の自動フォーマットを推奨

### ブランチ戦略
- `main`: 本番環境用
- `develop`: 開発用メインブランチ
- `feature/*`: 新機能開発
- `bugfix/*`: バグ修正
- `hotfix/*`: 緊急修正

### コミットメッセージ
以下の形式に従ってください：
```
<type>(<scope>): <subject>
<空行>
[optional body]
<空行>
[optional footer(s)]
```

**タイプ一覧**:
- feat: 新機能
- fix: バグ修正
- docs: ドキュメントの変更
- style: コードの意味に影響を与えない変更（フォーマットなど）
- refactor: バグ修正や機能の追加を行わないコードの変更
- perf: パフォーマンスを向上させるコード変更
- test: 不足しているテストの追加や既存のテストの修正
- chore: ビルドプロセスやドキュメント生成などの補助ツールやライブラリの変更

## トラブルシューティング

### 一般的な問題

#### バックエンドが起動しない
- 仮想環境が有効になっているか確認
- 必要な環境変数が設定されているか確認
- ポートが使用中でないか確認

#### フロントエンドでエラーが発生する
- 依存関係が正しくインストールされているか確認
- ブラウザの開発者ツールでエラーを確認
- キャッシュをクリアして再読み込み

### JavaScriptの読み込み問題
- `type="module"` を使用する場合、サーバーが正しいMIMEタイプでファイルを配信する必要があります
- エラーが発生する場合は、`<script src="..."></script>` の形式で読み込むことを検討してください
- ブラウザの開発者ツールのコンソールでエラーが表示されていないか確認してください

### デバッグのヒント
- `debugLog` 関数を使用して、重要な処理の前後にログを出力する
- イベントリスナーが正しく設定されているか確認するために、初期化時にコンソールログを出力する
- 動的に追加される要素のイベントは、イベントデリゲーションを使用することを検討する

## 貢献ガイドライン

1. イシューを作成して変更の提案
2. 機能ブランチを作成 (`feature/your-feature`)
3. コードスタイルに従って変更をコミット
4. テストを実行して問題がないことを確認
5. プルリクエストを作成

## ロードマップ

### 短期的な目標
- [ ] Quillエディタの統合
- [ ] シーン管理機能の強化
- [ ] ストーリー一覧ページの実装

### 中期的な目標
- [ ] ユーザー認証システム
- [ ] ストーリー公開機能
- [ ] テーマカスタマイズ機能

### 長期的な目標
- [ ] マルチプレイヤー機能
- [ ] アナリティクス統合
- [ ] プラグインシステム

## デプロイ

### 本番環境
```bash
# 本番用ビルド
cd static
npm run build
cd ..

# 本番サーバー起動
uvicorn main:app --host 0.0.0.0 --port 8000
```

### 環境変数
| 変数名 | 説明 | 必須 | デフォルト |
|--------|------|------|------------|
| `GEMINI_API_KEY` | Google Gemini APIキー | はい | - |
| `DATABASE_URL` | データベース接続URL | いいえ | sqlite:///./test.db |
| `DEBUG` | デバッグモード | いいえ | False |
