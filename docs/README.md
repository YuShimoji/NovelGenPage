# プロジェクトドキュメント

## 1. プロジェクト概要

ユーザーが入力したプロンプトに基づいて、AIが物語を自動生成するWebアプリケーションです。

## 2. アーキテクチャ

### バックエンド構成

- **`main.py`**: FastAPIアプリケーションのエントリーポイント、APIエンドポイント定義
- **`gemini_client.py`**: Google Gemini APIとの通信処理
- **`scenario_handler.py`**: シナリオファイルの保存・読み込み、アーカイブリスト管理

### フロントエンド構成

- **`static/js/main.js`**: アプリケーション全体のエントリーポイント、`HomeUI`クラスによるホーム画面の管理
- **`static/js/viewManager.js`**: `home-view`と`game-view`の表示切り替えを管理
- **`static/js/gameManager.js`**: ゲームデータの読み込みとゲームの初期化を管理
- **`static/js/gameLogic.js`**: ゲームの進行ロジック、ステップ遷移を処理
- **`static/js/gameState.js`**: ゲームの状態（インベントリ、フラグ）を管理
- **`static/js/ui.js`**: ゲーム画面のUI操作（タイプライター効果、ボタン描画）を担当
- **`static/js/commonUI.js`**: ローディングやエラー表示など、共通のUIコンポーネントを提供
- **`static/js/api.js`**: バックエンドAPIとの通信を共通化
- **`static/js/scenario-editor.js`**: シナリオ管理画面の機能

## 3. 仕様書

### 機能要件

- **シナリオ生成**: ユーザーはプロンプトを入力し、AIによるゲームシナリオ（JSON形式）を生成できる。
- **ゲームプレイ**: 生成されたシナリオをWeb上でプレイできる。選択肢によって物語が分岐する。
- **ゲームエンジン**: 
    - **条件分岐**: 特定のアイテム所持やフラグの状態によって、選択肢の表示/非表示を制御。
    - **インベントリ**: ゲーム内でアイテムを取得・管理。
    - **フラグ管理**: ゲームの進行状況をフラグで管理。
- **シナリオ管理画面 (`scenario-editor.html`)**:
    - **一覧表示**: 生成したシナリオを一覧で確認。
    - **編集機能**: シナリオのタイトル、説明、登場キャラクター、アイテム、フラグ、公開ステータスを編集・保存。
    - **階層表示とフィルタリング**: サイドバーでシナリオをテーマごとに階層表示し、テーマで絞り込みが可能。

### 非機能要件

- 高速なレスポンス
- 直感的なUI
- モジュール化されたコードベース
- 保守性の高いアーキテクチャ

## 4. 実装状況

- **バックエンド**: 完了
    - FastAPIによるAPIサーバー構築
    - Google Gemini APIとの連携
    - モジュール化によるコードの分離
- **フロントエンド**: 進行中
    - **ホーム画面**: ゲーム生成、一覧表示機能は完了
    - **ゲームプレイ画面**: UIコンポーネントは実装済みだが、画面遷移とゲーム初期化処理が不完全
    - **モジュール化**: ESモジュールによるリファクタリング完了

## 5. 開発ガイドライン

### コード構成

- **関心の分離**: 各モジュールは単一の責務を持つ
- **循環参照の回避**: モジュール間の依存関係を適切に管理
- **エラーハンドリング**: 各層で適切なエラー処理を実装

## 6. TODOリスト

- [x] JavaScriptのモジュール化リファクタリング
- [ ] ゲームプレイ画面の完成（画面遷移とゲーム初期化処理）
- [ ] シナリオ管理画面のUI/UX改善（編集フォームの操作性向上など）
- [ ] フロントエンドのテストコード追加（Jest）
- [ ] エンドツーエンド（E2E）テストの導入
- [ ] パフォーマンス最適化（画像やJSONデータの遅延読み込み）
- [ ] ゲームプレイ画面の完成（画面遷移とゲーム初期化処理）
- [ ] シナリオ管理画面のUI/UX改善（編集フォームの操作性向上など）
- [ ] フロントエンドのテストコード追加（Jest）