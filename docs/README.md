# プロジェクトドキュメント

## 1. プロジェクト概要

ユーザーが入力したプロンプトに基づいて、AIが物語を自動生成するWebアプリケーションです。

## 2. アーキテクチャ

### バックエンド構成

- **`main.py`**: FastAPIアプリケーションのエントリーポイント、APIエンドポイント定義
- **`gemini_client.py`**: Google Gemini APIとの通信処理
- **`scenario_handler.py`**: シナリオファイルの保存・読み込み、アーカイブリスト管理

### フロントエンド構成

- **`static/js/main-game.js`**: ゲームのエントリーポイント、ゲームデータ読み込み
- **`static/js/gameLogic.js`**: ゲームロジック、ステップ遷移処理
- **`static/js/gameState.js`**: ゲーム状態管理（インベントリ、フラグ）
- **`static/js/ui.js`**: UI操作、タイプライター効果、ボタンレンダリング
- **`static/js/main.js`**: メインページのシナリオ生成機能
- **`static/js/scenario-editor.js`**: シナリオ管理画面の機能
- **`static/js/api.js`**: API通信の共通処理

## 3. 仕様書

### 機能要件

- **シナリオ生成**: ユーザーはプロンプトを入力し、AIによるゲームシナリオ（JSON形式）を生成できる。
- **ゲームプレイ**: 生成されたシナリオをWeb上でプレイできる。選択肢によって物語が分岐する。
- **ゲームエンジン**: 
    - **条件分岐**: 特定のアイテム所持やフラグの状態によって、選択肢の表示/非表示を制御。
    - **インベントリ**: ゲーム内でアイテムを取得・管理。
    - **フラグ管理**: ゲームの進行状況をフラグで管理。
- **シナリオ管理画面 (`scenario-editor.html`)**:
    - **一覧表示**: 生成したシナリオを一覧で確認。
    - **編集機能**: シナリオのタイトル、説明、登場キャラクター、アイテム、フラグ、公開ステータスを編集・保存。
    - **階層表示とフィルタリング**: サイドバーでシナリオをテーマごとに階層表示し、テーマで絞り込みが可能。

### 非機能要件

- 高速なレスポンス
- 直感的なUI
- モジュール化されたコードベース
- 保守性の高いアーキテクチャ

## 4. 実装状況

- **バックエンド**: 完了
    - FastAPIによるAPIサーバー構築
    - Google Gemini APIとの連携
    - モジュール化によるコードの分離
- **フロントエンド**: 完了
    - HTML, CSS, JavaScriptによるUI実装
    - API連携
    - ES6モジュールによるコードの分離

## 5. 開発ガイドライン

### コード構成

- **関心の分離**: 各モジュールは単一の責務を持つ
- **循環参照の回避**: モジュール間の依存関係を適切に管理
- **エラーハンドリング**: 各層で適切なエラー処理を実装

## 6. TODOリスト

- [ ] UI/UXの改善
- [ ] エラーハンドリングの強化
- [ ] テストコードの追加
- [ ] パフォーマンスの最適化
- [ ] セキュリティの強化
- [ ] ドキュメントの充実