# 仕様書

## 1. 概要

本プロジェクトは、AIを活用してアドベンチャーゲームのシナリオライターの創作活動を支援するためのWebアプリケーションです。

ライターは、テーマやキーワードを入力することで、AIにシナリオの草案を生成させることができます。生成されたシナリオは、Web上のエディタで自由に編集・管理でき、すぐにテストプレイで動作を確認することが可能です。

## 2. 目的

- AIによるアイデア出しとシナリオの骨子作成により、ライターの創作における初期段階の負担を軽減する。
- シナリオのデータ構造をJSONで統一し、編集・管理・拡張を容易にする。
- 作成したシナリオを即座にテストプレイできる環境を提供し、トライ＆エラーのサイクルを高速化する。

## 3. 主要機能

### 3.1 AIによるシナリオ生成機能
- テーマとキーワードに基づき、AIがマークダウン形式のシナリオ草案を生成
- 生成されたシナリオは即座にエディタで編集可能

### 3.2 マルチビューエディタ
- **エディタビュー**: マークダウン形式での直接編集
- **WYSIWYGビュー**: リッチテキストエディタでの編集（Quill.js使用）
- **プレビュービュー**: 実際のゲーム画面での表示を確認
- **レイアウト切り替え**: エディタとプレビューの表示レイアウトを柔軟に変更可能

### 3.3 インタラクティブなプレビュー
- プレビュー画面上で選択肢をクリックしてシーン遷移をテスト
- フラグや変数の状態を確認可能なデバッグパネル

### 3.4 ストーリー管理機能
- カード形式のストーリー一覧表示
- フォルダによる整理（ネスト可能）
- メタデータ（最終更新日、シーン数、文字数など）の表示
- 検索・フィルタリング機能

### 3.5 エクスポート/インポート
- マークダウン形式でのエクスポート/インポート
- 画像やメディアの埋め込みサポート

## 4. アーキテクチャ

### 4.1 フロントエンド
- **コアライブラリ**: JavaScript (ES6+)
- **UIフレームワーク**: カスタムCSS + Tailwind CSS
- **エディタ**: Quill.js（WYSIWYG編集）
- **マークダウン処理**: marked.js + カスタムパーサー
- **状態管理**: カスタムイベントシステム

### 4.2 バックエンド
- **フレームワーク**: Python (FastAPI)
- **API**: RESTful API
- **認証**: JWTベースの認証（管理者機能用）

### 4.3 データストレージ
- **開発時**: メモリ内ストレージ（再起動でリセット）
- **本番環境**: SQLite または PostgreSQL
- **ファイルストレージ**: アップロードされたメディアファイル用のローカルストレージ

### 4.4 デプロイメント
- **コンテナ化**: Docker + Docker Compose
- **Webサーバー**: Uvicorn + Nginx（本番環境）
- **CI/CD**: GitHub Actions を使用した自動デプロイ

## 5. データモデル

### 5.1 ストーリー
```typescript
interface Story {
  id: string;                // 一意の識別子
  title: string;             // ストーリーのタイトル
  description: string;       // 短い説明
  content: string;           // マークダウン形式のコンテンツ
  folder_id: string | null;  // 所属フォルダID
  created_at: string;        // 作成日時 (ISO 8601)
  updated_at: string;        // 最終更新日時 (ISO 8601)
  metadata: {
    scene_count: number;     // シーン数
    word_count: number;      // 総文字数
    cover_image?: string;    // カバー画像URL
    tags: string[];          // タグ
  };
}
```

### 5.2 フォルダ
```typescript
interface Folder {
  id: string;               // 一意の識別子
  name: string;             // フォルダ名
  parent_id: string | null; // 親フォルダID（ネスト用）
  created_at: string;       // 作成日時
  updated_at: string;       // 更新日時
}
```

## 6. API仕様

### 6.1 ストーリー関連
- `GET /api/v1/stories` - ストーリー一覧の取得
- `GET /api/v1/stories/{id}` - 特定のストーリーを取得
- `POST /api/v1/stories` - 新しいストーリーを作成
- `PUT /api/v1/stories/{id}` - ストーリーを更新
- `DELETE /api/v1/stories/{id}` - ストーリーを削除

### 6.2 フォルダ関連
- `GET /api/v1/folders` - フォルダ一覧の取得
- `POST /api/v1/folders` - 新しいフォルダを作成
- `PUT /api/v1/folders/{id}` - フォルダを更新
- `DELETE /api/v1/folders/{id}` - フォルダを削除

## 7. フロントエンドコンポーネント

### 7.1 エディタコンポーネント
- ツールバー（書式設定、シーン/選択肢の挿入など）
- マークダウンエディタ
- WYSIWYGエディタ（Quill）
- リアルタイムプレビュー

### 7.2 ストーリー一覧コンポーネント
- グリッド/リスト表示の切り替え
- ソート機能（更新日、作成日、タイトル順）
- 検索とフィルタリング
- ドラッグ&ドロップによる並び替え

### 7.3 フォルダナビゲーション
- ツリービューでのフォルダ階層表示
- ドラッグ&ドロップによる整理
- コンテキストメニュー（名前変更、削除など）

## 8. 今後の拡張予定

### 8.1 コラボレーション機能
- 複数ユーザーでの同時編集
- コメントとフィードバック機能
- 変更履歴とバージョン管理

### 8.2 テンプレート機能
- ジャンル別のテンプレート
- カスタムテンプレートの作成と共有

### 8.3 公開と共有
- ストーリーの公開設定
- 限定公開URLの生成
- エクスポート形式の追加（EPUB, PDFなど）

## 5. API仕様

### `POST /api/generate`

- **説明**: AIにシナリオの草案を生成させます。
- **リクエストボディ**:
  ```json
  {
    "theme": "string",
    "keywords": "string"
  }
  ```
- **レスポンス**: 生成されたシナリオのJSONデータ

### `GET /api/stories`

- **説明**: 保存されているシナリオの一覧を取得します。
- **レスポンス**: シナリオのメタデータ（ID, タイトル, 説明など）の配列

### `GET /api/scenario/{game_id}`

- **説明**: 指定した `game_id` のシナリオデータを取得します。
- **レスポンス**: シナリオの完全なJSONデータ

### `POST /api/update_scenario`

- **説明**: 既存のシナリオを更新します。
- **リクエストボディ**: シナリオの完全なJSONデータ
- **レスポンス**: 成功メッセージ
